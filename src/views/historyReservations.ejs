<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History reservations</title>
    <link rel="stylesheet" href="../public/css/styleHistory.css">
</head>
<body>
    <!-- Insertando el navbar -->
    <%- include("../views/partials/navbar.ejs") %>

    <section id="history-section">
        <div class="reservations">
            <div class="futureReservations">
                <span class="futureReservations-title">Future reservations</span>
                
                <!-- Mostrando todas las reservas futuras asociadas al usuario-->
                <% if(futureReservations.length !== 0){%>
                    <span class="secondTitle">Gestiona tus reservas</span>
                    <% futureReservations.forEach(reserv =>{ %>
                        <div class="futureReservation">
                            <div class="reservationDate">
                                <div class="divDateTime">
                                    <div class="datetime"> 
                                        <img src="../public/imgs/historial/icons8-calendario-96.png" alt="">
                                        <span>Fecha</span>
                                    </div>
                                    <span class="white"> <%- reserv.fecha_reserva.toISOString().split("T")[0] %>  </span>
                                </div>
                                <div class="divDateTime">
                                    <div class="datetime"> 
                                        <img src="../public/imgs/historial/icons8-reloj-150 (1).png" alt="">
                                        <span>Hora</span>
                                    </div>
                                    <span class="white"> <%- reserv.hora_reserva %>  </span>
                                </div>
                            </div>
                            <div class="tableReserved">
                                <span class="tableTitle">Table reserved</span>
                                <span class="white"> <%- reserv.id_mesa_reserva %>  </span>
                            </div>
                            <div class="saucer">
                                <span class="saucerTitle">Requested saucer</span>
                                <span class="white"> <%- reserv.nombre_entrada %> </span>
                            </div>
                            <button class="btn" data-reserva-id = "<%- reserv.id_reserva %>">
                                <img src="../public/imgs/historial/icons8-x-96.png" alt="img cancelar" class="img-cancelar" />
                                Cancel reservation
                            </button>
                        </div>
                    <% }) %>
                <% }else{ %>
                    <!-- Mostrando mensaje de que el usuario no tiene reservas -->
                    <h3>No tienes ninguna reserva creada en este momento</h3>
                <%} %>               

            </div> 
            <div class="pastReservations">
                <span class="pastReservations-title">Past reservations</span>

                <!-- Mostrando reservas pasadas asociadas al usuario -->
                <% if(pastReservations.length !== 0){%>
                    <% pastReservations.forEach((reserv) =>{ %>
                        <div class="futureReservation">
                            <div class="reservationDate">
                                <div class="divDateTime">
                                    <div class="datetime"> 
                                        <img src="../public/imgs/historial/icons8-calendario-96.png" alt="">
                                        <span>Fecha</span>
                                    </div>
                                    <span class="white"> <%- reserv.fecha_reserva.toISOString().split("T")[0] %> </span>
                                </div>
                                <div class="divDateTime">
                                    <div class="datetime"> 
                                        <img src="../public/imgs/historial/icons8-reloj-150 (1).png" alt="">
                                        <span>Hora</span>
                                    </div>
                                    <span class="white"> <%- reserv.hora_reserva %> </span>
                                </div>
                            </div>
                            <div class="tableReserved">
                                <span class="tableTitle">Table reserved</span>
                                <span class="white"> <%- reserv.id_mesa_reserva %> </span>
                            </div>
                            <div class="saucer">
                                <span class="saucerTitle">Requested saucer</span>
                                <span class="white"> <%- reserv.nombre_entrada%>  </span>
                            </div>
                        </div> 
                    <% }) %>
                <% }else{ %>
                    <!-- Mostrando mensaje de que el usuario no tiene reservas -->
                    <h3>No tienes ninguna reservas pasadas</h3>
                <%} %>
 
            </div>
        </div>
    </section>

    <div id="modal">
        <h3>¿Estas seguro de que quieres eliminar esta reserva?</h3>
        <div>
            <button id="btn-yes">
                Continuar
            </button>
            <button id="btn-no">
                Cancelar
            </button>
        </div>
    </div>

    <!-- Como el modal va a estar con opacidad 0 al inicio, puedo colocarlo aqui sin problemas -->
     <div id="modalInfo">
        <img src="../public/imgs/historial/icons8-información-250.png" alt="Icono de informacion">
        <h3> <%= flash.message %> </h3>
        <button id="closeInfoModal">
            Cerrar
        </button>
    </div>

    <!-- Cargo el script antes de la llamada de la funcion js -->
    <script src="../public/js/history.js"></script>

    <% if(flash.message !== null){ %>
        <script>
            const message = '<%= flash.message %>';
            const type = '<%= flash.type %>';
            showInfoModal(message, type);

            // Quitar los parámetros de la URL
            //history.replaceState(null, "", "/history");
        </script>
    <% } %>
   
</body>
</html>





